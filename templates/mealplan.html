{% extends "base.html" %}
{% block title %}Meal Plan{% endblock %}
{% block content %}
  <h2>Weekly Meal Plan</h2>
  <p>Week starting: {{ week_start }}</p>
  <p>Generated on: {{ generated_on }}</p>

  <form method="post" action="{{ url_for('regenerate_mealplan') }}">
    <button type="submit">Regenerate this week's plan</button>
  </form>

  <table class="list" style="margin-top:12px;">
    <thead><tr><th>Day</th><th>Recipe</th><th>Match (%)</th></tr></thead>
    <tbody>
      {% for p in plan %}
        <tr>
          <td>Day {{ p.day }}</td>
          <td>
            {% if p.recipe_id %}
              <a href="{{ url_for('view_recipe', id=p.recipe_id) }}">{{ p.title }}</a>
            {% else %}
              {{ p.title }}
            {% endif %}
          </td>
          <td>{{ "%.0f"|format(p.match) if p.match else '0' }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <p>
    <a href="{{ url_for('export_mealplan', fmt='json') }}">Export Plan (JSON)</a> |
    <a href="{{ url_for('export_mealplan', fmt='csv') }}">Export Plan (CSV)</a>
  </p>

  <h3>Candidate recipes (≥50% available)</h3>
  {% if candidates %}
    <ul>
      {% for c in candidates %}
        <li>{{ c.title }} — {{ "%.0f"|format(c.percent) }}% ({{ c.available }}/{{ c.total }} available)</li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No candidate recipes meet the 50% availability threshold.</p>
  {% endif %}
{% endblock %}
